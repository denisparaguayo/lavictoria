---
import SiteLayout from '../../layouts/SiteLayout.astro';
import { servicios } from '../../data/servicios.js';
import { siteConfig } from '../../config/siteConfig.js';

export async function getStaticPaths() {
	return servicios.map((s) => ({
		params: { slug: s.slug },
		props: { item: s },
	}));
}

const { item } = Astro.props;
const origin = import.meta.env.DEV ? 'http://localhost:4321' : siteConfig.url;
const serviceUrl = `${origin}/servicios/${item.slug}`;
const coverJpg = `/img/servicios/${item.slug}/cover.jpg`;
const coverWebp = `/img/servicios/${item.slug}/cover.webp`;

// Importar todas las imágenes de la carpeta galería
const galleryModules = import.meta.glob(
	'../../assets/img/servicios/**/galeria/*.{jpg,jpeg,png,webp,avif}',
	{ eager: true, import: 'default' }
);
const gallery = Object.entries(galleryModules)
	.filter(([path]) => path.includes(`/servicios/${item.slug}/galeria/`))
	.map(([_, url]) => url);
---

<SiteLayout
	title={`${item.titulo} – Marmolería La Victoria`}
	description={item.descripcion}>
	<script
		type="application/ld+json"
		set:html={JSON.stringify({
			'@context': 'https://schema.org',
			'@type': 'Service',
			name: item.titulo,
			description: item.descripcion,
			provider: {
				'@type': 'HomeAndConstructionBusiness',
				name: siteConfig.name,
				url: siteConfig.url,
				telephone: siteConfig.contact.phone,
			},
			areaServed: { '@type': 'AdministrativeArea', name: 'Asunción' },
			image: `${origin}${coverJpg}`,
			url: serviceUrl,
		})}
	/>

	<nav
		aria-label="breadcrumb"
		class="mx-auto max-w-6xl px-4 pt-6 text-sm text-neutral-600">
		<a href="/" class="hover:text-neutral-800">Inicio</a>
		<span class="mx-2">/</span>
		<a href="/servicios" class="hover:text-neutral-800">Servicios</a>
		<span class="mx-2">/</span>
		<span class="text-neutral-800">{item.titulo}</span>
	</nav>

	<section class="mx-auto max-w-6xl px-4 py-8 grid gap-8 lg:grid-cols-2">
		<div class="aspect-[4/3] bg-neutral-100 overflow-hidden rounded-2xl">
			<picture>
				<source srcset={coverWebp} type="image/webp" />
				<img
					src={coverJpg}
					alt={item.titulo}
					class="h-full w-full object-cover"
					loading="eager"
				/>
			</picture>
		</div>
		<div>
			<h1 class="text-3xl font-semibold font-display">{item.titulo}</h1>
			<p class="mt-3 text-neutral-700">{item.descripcion}</p>
			{
				item.puntos && (
					<ul class="mt-6 grid gap-2 text-sm text-neutral-700 list-disc pl-5">
						{item.puntos.map((p) => (
							<li>{p}</li>
						))}
					</ul>
				)
			}

			<div class="mt-8 flex flex-wrap gap-3">
				<a
					href={siteConfig.contact.whatsapp}
					class="inline-flex items-center rounded-xl border border-yellow-700/30 bg-yellow-600 px-5 py-3 text-sm font-semibold text-white shadow hover:bg-yellow-700"
					>Pedir presupuesto</a
				>
				<a
					href="/servicios"
					class="inline-flex items-center rounded-xl border px-5 py-3 text-sm font-semibold text-neutral-700 hover:bg-neutral-50"
					>Volver a Servicios</a
				>
			</div>
		</div>
	</section>

	<section class="mx-auto max-w-7xl px-4 pb-12">
		<h2 class="text-2xl font-semibold font-display mb-4">Galería</h2>
		{
			gallery.length > 0 ? (
				<div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
					{gallery.map((imgUrl) => (
						<div class="aspect-[4/3] overflow-hidden rounded-2xl bg-neutral-100">
							<img
								src={imgUrl}
								alt={`${item.titulo} - foto`}
								class="h-full w-full object-cover"
								loading="lazy"
							/>
						</div>
					))}
				</div>
			) : (
				<p class="text-sm text-neutral-600">
					Agregá imágenes en{' '}
					<code>src/assets/img/servicios/{item.slug}/galeria</code> para
					mostrarlas acá.
				</p>
			)
		}
	</section>
</SiteLayout>
