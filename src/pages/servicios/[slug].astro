---
import SiteLayout from '../../layouts/SiteLayout.astro';
import { getCollection } from 'astro:content';
import { siteConfig } from '../../config/siteConfig.js';
import GaleriaServicio from '../../components/GaleriaServicio.astro';

export async function getStaticPaths() {
	const servicios = await getCollection('servicios');
	return servicios.map((servicio) => ({
		params: { slug: servicio.slug },
		props: { servicio },
	}));
}

const { servicio } = Astro.props;
const data = servicio.data;
const origin = import.meta.env.DEV ? 'http://localhost:4321' : siteConfig.url;
const serviceUrl = `${origin}/servicios/${servicio.slug}`;
---

<SiteLayout
	title={`${data.title} – Marmolería La Victoria`}
	description={data.description}>
	<script
		type="application/ld+json"
		set:html={JSON.stringify({
			'@context': 'https://schema.org',
			'@type': 'Service',
			name: data.title,
			description: data.description,
			provider: {
				'@type': 'HomeAndConstructionBusiness',
				name: siteConfig.name,
				url: siteConfig.url,
				telephone: siteConfig.contact.phone,
			},
			areaServed: { '@type': 'AdministrativeArea', name: 'Asunción' },
			image: `${origin}${data.cover}`,
			url: serviceUrl,
		})}
	/>

	<nav
		aria-label="breadcrumb"
		class="mx-auto max-w-6xl px-4 pt-6 text-sm text-neutral-600">
		<a href="/" class="hover:text-neutral-800">Inicio</a>
		<span class="mx-2">/</span>
		<a href="/servicios" class="hover:text-neutral-800">Servicios</a>
		<span class="mx-2">/</span>
		<span class="text-neutral-800">{data.title}</span>
	</nav>

	<section class="mx-auto max-w-6xl px-4 py-8 grid gap-8 lg:grid-cols-2">
		<div class="aspect-[4/3] bg-neutral-100 overflow-hidden rounded-2xl">
			<img
				src={data.cover}
				alt={data.title}
				class="h-full w-full object-cover"
				loading="eager"
			/>
		</div>
		<div>
			<h1 class="text-3xl font-semibold font-display">{data.title}</h1>
			<p class="mt-3 text-neutral-700">{data.description}</p>
			{
				data.puntos && (
					<ul class="mt-6 grid gap-2 text-sm text-neutral-700 list-disc pl-5">
						{data.puntos.map((p) => (
							<li>{p}</li>
						))}
					</ul>
				)
			}

			<div class="mt-8 flex flex-wrap gap-3">
				<a
					href={siteConfig.contact.whatsapp}
					class="inline-flex items-center rounded-xl border border-yellow-700/30 bg-yellow-600 px-5 py-3 text-sm font-semibold text-white shadow hover:bg-yellow-700"
					>Pedir presupuesto</a
				>
				<a
					href="/servicios"
					class="inline-flex items-center rounded-xl border px-5 py-3 text-sm font-semibold text-neutral-700 hover:bg-neutral-50"
					>Volver a Servicios</a
				>
			</div>
		</div>
	</section>

	<section class="mx-auto max-w-7xl px-4 pb-12">
		<h2 class="text-2xl font-semibold font-display mb-4">Galería</h2>
		<GaleriaServicio slug={servicio.slug} title={data.title} />
	</section>

	<script>
		document.addEventListener('DOMContentLoaded', () => {
			GLightbox({
				selector: '.gallery-item',
				touchNavigation: true,
				loop: true,
				zoomable: true,
			});
		});
	</script>
</SiteLayout>
